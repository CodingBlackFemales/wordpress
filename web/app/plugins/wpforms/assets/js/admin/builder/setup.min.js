"use strict";var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.Setup=WPForms.Admin.Builder.Setup||function(a,s){var o={},r={};const l=s(".wpforms-template.selected .wpforms-template-name").text().trim();var n={init(){s(n.ready),s(a).on("load",function(){"function"==typeof s.ready.then?s.ready.then(n.load):n.load()})},ready(){n.setup(),n.setPanelsToggleState(),n.setupTitleFocus(),n.setTriggerBlankLink(),n.setSelectedTemplate(),n.events(),o.$builder.trigger("wpformsBuilderSetupReady")},load(){n.applyTemplateOnRequest()},setup(){o={$builder:s("#wpforms-builder"),$form:s("#wpforms-builder-form"),$formName:s("#wpforms-setup-name"),$panel:s("#wpforms-panel-setup"),$categories:s("#wpforms-panel-setup .wpforms-setup-templates-categories")},r.spinner='<i class="wpforms-loading-spinner wpforms-loading-white wpforms-loading-inline"></i>',r.formID=o.$form.data("id")},events(){o.$builder.on("wpformsBuilderPanelLoaded",n.panelLoaded),n.panelEvents(),o.$builder.on("wpformsPanelSwitched",n.setupTitleFocus),o.$builder.on("input","#wpforms-panel-field-settings-form_title",n.syncTitle).on("input","#wpforms-setup-name",n.syncTitle)},panelEvents(){o.$panel.on("keyup","#wpforms-setup-template-search",_.debounce(WPFormsFormTemplates.searchTemplate,200)).on("click",".wpforms-setup-templates-categories li div",WPFormsFormTemplates.selectCategory).on("click",".wpforms-setup-templates-categories li .chevron",WPFormsFormTemplates.toggleSubcategoriesList).on("click",".wpforms-setup-templates-subcategories li",WPFormsFormTemplates.selectSubCategory).on("click",".wpforms-template-select",n.selectTemplate).on("click",".wpforms-trigger-blank",n.selectBlankTemplate)},panelLoaded(e,t){"setup"===t&&(n.setup(),WPFormsFormTemplates.setup(),n.setSelectedTemplate(),n.panelEvents())},setPanelsToggleState:function(){o.$builder.find("#wpforms-panels-toggle button:not(.active)").toggleClass("wpforms-disabled",""===r.formID)},setTriggerBlankLink:function(){o.$builder.find(".wpforms-trigger-blank").attr({"data-template-name-raw":"Blank Form","data-template":"blank"})},setupTitleFocus(e,t){"setup"===(t=t||wpf.getQueryString("view"))&&(s("#wpforms-setup-name").val(s("#wpforms-panel-field-settings-form_title").val()),o.$formName.trigger("focus"))},setSelectedTemplate(){var e;o.$panel.length&&wpforms_builder.form_meta?.template&&(e=o.$builder.find(`.wpforms-template-select[data-template="${wpforms_builder.form_meta.template}"]`).closest(".wpforms-template")).length&&(e.addClass("selected").addClass("badge"),e.find(".wpforms-badge").remove(),e.find(".wpforms-template-favorite").after(wpforms_builder.template_selected_badge))},syncTitle:function(e){("wpforms-setup-name"===e.target.id?s("#wpforms-panel-field-settings-form_title"):s("#wpforms-setup-name")).val(e.target.value)},searchTemplate:function(e){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.searchTemplate( e )" has been deprecated, please use the new "WPFormsFormTemplates.searchTemplate( e )" function instead!'),WPFormsFormTemplates.searchTemplate(e)},selectCategory:function(e){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.selectCategory( e )" has been deprecated, please use the new "WPFormsFormTemplates.selectCategory( e )" function instead!'),WPFormsFormTemplates.selectCategory(e)},selectTemplate:function(e){e.preventDefault();var e=s(this),t=e.data("template"),a=n.getFormName(e);e.hasClass("education-modal")||(o.$panel.find(".wpforms-template").removeClass("active"),e.closest(".wpforms-template").addClass("active"),e.data("labelOriginal",e.html()),e.html(r.spinner+wpforms_builder.loading),n.applyTemplate(a,t,e))},getFormName:function(e){var e=e.data("template-name-raw"),t=o.$formName.val();return!t||l===t?e:t},applyTemplate:function(e,t,a){o.$builder.trigger("wpformsTemplateSelect",t),r.formID?n.selectTemplateExistingForm(e,t,a):WPFormsFormTemplates.selectTemplateProcess(e,t,a,n.selectTemplateProcessAjax)},selectBlankTemplate:function(e){e.preventDefault();var e=s(e.target),t=o.$formName.val()||wpforms_builder.blank_form;n.applyTemplate(t,"blank",e)},selectTemplateExistingForm:function(e,t,a){s.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.template_confirm,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){WPFormsFormTemplates.selectTemplateProcess(e,t,a,n.selectTemplateProcessAjax)}},cancel:{text:wpforms_builder.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},selectTemplateProcess:function(e,t,a){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.selectTemplateProcess( formName, template, $button )" has been deprecated, please use the new "WPFormsFormTemplates.selectTemplateProcess( formName, template, $button, callback )" function instead!'),WPFormsFormTemplates.selectTemplateProcess(e,t,a,n.selectTemplateProcessAjax)},selectTemplateCancel:function(){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.selectTemplateCancel" has been deprecated, please use the new "WPFormsFormTemplates.selectTemplateCancel" function instead!'),WPFormsFormTemplates.selectTemplateCancel()},selectTemplateProcessAjax:function(t,e){WPFormsBuilder.showLoadingOverlay();e={title:t,action:r.formID?"wpforms_update_form_template":"wpforms_new_form",template:e,form_id:r.formID,nonce:wpforms_builder.nonce};s.post(wpforms_builder.ajax_url,e).done(function(e){e.success?(WPFormsBuilder.setCloseConfirmation(!1),a.location.href=wpf.getQueryString("force_desktop_view")?wpf.updateQueryString("force_desktop_view",1,e.data.redirect):e.data.redirect):(wpf.debug(e),"invalid_template"===e.data.error_type?n.selectTemplateProcessInvalidTemplateError(e.data.message,t):n.selectTemplateProcessError(e.data.message))}).fail(function(e,t,a){wpf.debug(e.responseText||t||""),n.selectTemplateProcessError("")})},selectTemplateProcessInvalidTemplateError:function(e,t){s.alert({title:wpforms_builder.heads_up,content:e,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"600px",buttons:{confirm:{text:wpforms_builder.use_simple_contact_form,btnClass:"btn-confirm",keys:["enter"],action:function(){n.selectTemplateProcessAjax(t,"simple-contact-form-template"),WPFormsBuilder.hideLoadingOverlay()}},cancel:{text:wpforms_builder.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel(),WPFormsBuilder.hideLoadingOverlay()}}}})},selectTemplateProcessError:function(e){e=e&&e.length?"<p>"+e+"</p>":"";s.alert({title:wpforms_builder.heads_up,content:wpforms_builder.error_select_template+e,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){WPFormsFormTemplates.selectTemplateCancel(),WPFormsBuilder.hideLoadingOverlay()}}}})},addonsModal:function(e,t,a){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.addonsModal( formName, template, $button )" has been deprecated, please use the new "WPFormsFormTemplates.addonsModal( formName, template, $button, callback )" function instead!'),WPFormsFormTemplates.addonsModal(e,t,a,n.selectTemplateProcessAjax)},installActivateAddons:function(e,t,a,s){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.installActivateAddons( addons, previousModal, formName, template )" has been deprecated, please use the new "WPFormsFormTemplates.installActivateAddons( addons, previousModal, formName, template, callback )" function instead!'),WPFormsFormTemplates.installActivateAddons(e,t,a,s,n.selectTemplateProcessAjax)},installActivateAddonsError:function(e,t){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.installActivateAddonsError( formName, template )" has been deprecated, please use the new "WPFormsFormTemplates.installActivateAddonsError( formName, template, callback )" function instead!'),WPFormsFormTemplates.installActivateAddonsError(e,t,n.selectTemplateProcessAjax)},installActivateAddonAjax:function(e){return console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.installActivateAddonAjax( addon )" has been deprecated, please use the new "WPFormsFormTemplates.installActivateAddonAjax( addon )" function instead!'),WPFormsFormTemplates.installActivateAddonAjax(e)},applyTemplateOnRequest:function(){var e=new URLSearchParams(a.location.search),t=e.get("template_id");"setup"===e.get("view")&&!e.get("form_id")&&t&&o.$panel.find('.wpforms-template .wpforms-btn[data-template="'+t+'"]').trigger("click")}};return n}((document,window),jQuery),WPForms.Admin.Builder.Setup.init();