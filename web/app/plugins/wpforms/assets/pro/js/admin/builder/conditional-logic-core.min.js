"use strict";var WPFormsConditionals=window.WPFormsConditionals||function(n,s){var o={arraySplitIntoChunks:function(e,i){return e.length?[e.slice(0,i)].concat(o.arraySplitIntoChunks(e.slice(i),i)):[]}},r={allFields:{},$ruleRows:{},conditionalFields:{},fieldsListTemplate:"",fieldValuesListTemplates:{},cacheAllFields:function(e){r.allFields=e},cacheRuleRows:function(e){r.$ruleRows=e||s(".wpforms-conditional-row")},setConditionalFields:function(){r.conditionalFields=r.removeUnsupportedFields()},removeUnsupportedFields(){const i=wpforms_builder.cl_fields_supported;let o={...r.allFields};return o=wp.hooks.applyFilters("wpforms.ConditionalLogicCore.BeforeRemoveUnsupportedFields",o),Object.keys(o).forEach(e=>{i.includes(o[e].type)&&!o[e].dynamic_choices||delete o[e]}),o},setTemplates:function(){r.setFieldsListTemplate(),r.fieldValuesListTemplates={}},setFieldsListTemplate(){var i=s("<select>").append(s("<option>",{value:"",text:wpforms_builder.select_field}));for(const t in r.conditionalFields){var o=r.conditionalFields[t];let e;e=void 0!==o.label&&""!==o.label.toString().trim()?wpf.sanitizeHTML(o.label.toString().trim()):wpforms_builder.field+" #"+o.id,i.append(s("<option>",{value:o.id,text:e,id:"option-"+o.id}))}r.fieldsListTemplate=i.html()},getFieldValuesListTemplate(e,i){if(r.fieldValuesListTemplates[i])return r.fieldValuesListTemplates[i];var o=wpf.orders.choices["field_"+i],t=s("<select>"),n=Object.values(wpf.getFields()).find(e=>e.id.toString()===i.toString());for(const a in o){var l=o[a],d=void 0!==n.choices[l]&&""!==n.choices[l].label.toString().trim()?wpf.sanitizeHTML(n.choices[l].label.toString().trim()):wpforms_builder.choice_empty_label_tpl.replace("{number}",l);t.append(s("<option>",{value:l,text:d,id:"choice-"+l}))}return r.fieldValuesListTemplates[i]=t.html()},updateConditionalRuleRows:function(){r.$ruleRows.length;o.arraySplitIntoChunks(r.$ruleRows,20).map(function(i){return setTimeout(function(){for(var e=0;e<i.length;++e)r.updateConditionalRuleRow(i[e]),0},0),i})},updateConditionalRuleRow:function(e){var e=s(e),i=e.attr("data-field-id"),o=e.find(".wpforms-conditional-field"),t=o.val(),n=e.find(".wpforms-conditional-value");o[0].innerHTML=r.fieldsListTemplate,o.find("#option-"+i).remove(),(t?(o.find("#option-"+t).length?r.restorePreviousRuleRowSelection(e,o,t,n):r.removeRuleRow(e),o.find("option").removeAttr("id"),n):o).find("option").removeAttr("id")},fieldDeleteConfirmAlert:function(e){var i,o=wpforms_builder.conditionals_change+"<br>";wpf.empty(r.allFields)&&r.cacheAllFields(wpf.getFields()),s(".wpforms-conditional-field").each(function(){e.id!==Number(s(this).val())||e.choiceId&&e.choiceId!==Number(s(this).closest(".wpforms-conditional-row").find(".wpforms-conditional-value").val())||(o+=r.getChangedFieldNameForAlert(s(this).closest(".wpforms-conditional-group").data("reference")),i=!0,e.trigger=!0)}),i&&(e.message="<strong>"+e.message+"</strong><br><br>"+o)},restorePreviousRuleRowSelection:function(e,i,o,t){i.find("#option-"+o).prop("selected",!0),t.length&&t.is("select")&&(i=t.val(),t[0].innerHTML=r.getFieldValuesListTemplate(r.conditionalFields,o),t.find("#choice-"+i).length)&&t.find("#choice-"+i).prop("selected",!0)},removeRuleRow:function(e){var i=e.closest(".wpforms-conditional-group");1===i.find("table >tbody >tr").length?1<e.closest(".wpforms-conditional-groups").find(".wpforms-conditional-group").length?i.remove():(e.find(".wpforms-conditional-value").remove(),e.find(".value").append("<select>")):e.remove()},getChangedFieldNameForAlert:function(e){return wpf.isNumber(e)?((r.allFields[e]||{}).label||"").length?"<br/>"+wpf.sanitizeString(r.allFields[e].label)+" ("+wpforms_builder.field+" #"+e+")":"<br>"+wpforms_builder.field+" #"+e:"<br>"+e}},l={init:function(){s(WPFormsConditionals.ready)},ready:function(){WPFormsConditionals.bindUIActions()},getLayoutFieldsToExclude(e){e=e.parents(".wpforms-field-option").find(".wpforms-field-option-hidden-id").val();const i=wpf.formObject("#wpforms-field-options");e=i?.fields[e]??[];const o={};return Object.values(e["columns-json"]??{}).forEach(e=>{Object.values(e?.fields??[]).forEach(e=>{i.fields[e]&&(o[e]=i.fields[e])})}),o},bindUIActions:function(){var e=s("#wpforms-builder");e.on("change",".wpforms-conditionals-enable-toggle input[type=checkbox]",function(e){WPFormsConditionals.conditionalToggle(this,e)}),e.on("click",".wpforms-field-option-group-conditionals",function(){var e,i=s(this);"layout"===i.parents(".wpforms-field-option").find(".wpforms-field-option-hidden-type").val()&&(e=i.find(".wpforms-conditional-block"),i=wpf.getFields(!1,!0,!1,l.getLayoutFieldsToExclude(i)),WPFormsConditionals.conditionalUpdateOptions(!1,i,e.find(".wpforms-conditional-row")))}),e.on("change",".wpforms-conditional-field",function(e){WPFormsConditionals.conditionalField(this,e)}),e.on("change",".wpforms-conditional-operator",function(e){WPFormsConditionals.conditionalOperator(this,e)}),e.on("click",".wpforms-conditional-rule-add",function(e){WPFormsConditionals.conditionalRuleAdd(this,e)}),e.on("click",".wpforms-conditional-rule-delete",function(e){WPFormsConditionals.conditionalRuleDelete(this,e)}),e.on("click",".wpforms-conditional-groups-add",function(e){WPFormsConditionals.conditionalGroupAdd(this,e)}),s(n).on("wpformsFieldUpdate",WPFormsConditionals.conditionalUpdateOptions),e.on("wpformsBeforeFieldDeleteAlert",function(e,i){r.fieldDeleteConfirmAlert(i)})},conditionalUpdateOptions:function(e,i,o){wpf.empty(i)||(r.cacheAllFields(i),r.cacheRuleRows(o),r.setConditionalFields(),r.setTemplates(),r.updateConditionalRuleRows())},conditionalToggle:function(e,i){i.preventDefault();var o=s(e),t=o.closest(".wpforms-conditional-block"),i=wp.template("wpforms-conditional-block"),e={fieldID:o.closest(".wpforms-field-option-row").data("field-id"),fieldName:o.data("name"),actions:o.data("actions"),actionDesc:o.data("action-desc")};o.is(":checked")?(t.append(i(e)),i=wpf.getFields(!1,!0,!1,l.getLayoutFieldsToExclude(o)),WPFormsConditionals.conditionalUpdateOptions(!1,i,t.find(".wpforms-conditional-row"))):s.confirm({title:!1,content:wpforms_builder.conditionals_disable,backgroundDismiss:!1,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){t.find(".wpforms-conditional-groups").remove(),s(n).trigger("wpformsRemoveConditionalLogicRules",[o])}},cancel:{text:wpforms_builder.cancel,action:function(){o.prop("checked",!0)}}}})},conditionalField:function(e,i){i.preventDefault();var o,i=s(e),e=i.parent().parent(),t=e.find(".wpforms-conditional-operator"),n=t.find("option:selected").val(),l=WPFormsConditionals.conditionalData(i),i=l.inputName+"["+l.groupID+"]["+l.ruleID+"][value]";if(l.field)if("select"===l.field.type||"radio"===l.field.type||"checkbox"===l.field.type||"payment-multiple"===l.field.type||"payment-checkbox"===l.field.type||"payment-select"===l.field.type){if((o=s("<select>").attr({name:i,class:"wpforms-conditional-value"})).append(s("<option>",{value:"",text:wpforms_builder.select_choice})),l.field.choices)for(var d in wpf.orders.choices["field_"+l.field.id]){var d=wpf.orders.choices["field_"+l.field.id][d],a=void 0!==l.field.choices[d].label&&""!==l.field.choices[d].label.toString().trim()?wpf.sanitizeHTML(l.field.choices[d].label.toString().trim()):wpforms_builder.choice_empty_label_tpl.replace("{number}",d);o.append(s("<option>",{value:d,text:wpf.sanitizeHTML(a)}))}t.find("option:not([value='=='],[value='!='],[value='e'],[value='!e'])").prop("disabled",!0).prop("selected",!1)}else{var r="text";"rating"!==l.field.type&&"net_promoter_score"!==l.field.type&&"number-slider"!==l.field.type||(r="number"),o=s("<input>").attr({type:r,name:i,class:"wpforms-conditional-value"}),t.find("option").prop("disabled",!1)}else o=s("<select>");"e"!==n&&"!e"!==n||o.prop("disabled",!0),e.find(".value").empty().append(o)},conditionalOperator:function(e,i){i.preventDefault();i=s(e),e=i.parent().parent().find(".wpforms-conditional-value"),i=i.find("option:selected").val();"e"===i||"!e"===i?(e.prop("disabled",!0),e.is("select")?e.find("option:selected").prop("selected",!1):e.val("")):e.prop("disabled",!1)},conditionalRuleAdd:function(e,i){i.preventDefault();var i=s(e).closest(".wpforms-conditional-group").find("tr").last(),e=i.clone(),o=e.find(".wpforms-conditional-field"),t=e.find(".wpforms-conditional-operator"),n=WPFormsConditionals.conditionalData(o),l=Number(n.ruleID)+1,n=n.inputName+"["+n.groupID+"]["+l+"]";e.find("option:selected").prop("selected",!1),e.find(".value").empty().append(s("<select>")),o.attr("name",n+"[field]").attr("data-ruleid",l),t.attr("name",n+"[operator]"),i.after(e)},conditionalRuleDelete:function(e,i){i.preventDefault();var i=s(e),e=i.closest(".wpforms-conditional-group"),o=e.find("table >tbody >tr");o&&1===o.length?1<i.closest(".wpforms-conditional-groups").find(".wpforms-conditional-group").length?e.remove():(o.find(".wpforms-conditional-operator").val("==").trigger("change"),o.find(".wpforms-conditional-value").val("").trigger("change"),o.find(".wpforms-conditional-field").val("").trigger("change")):i.parent().parent().remove()},conditionalGroupAdd:function(e,i){i.preventDefault();var i=s(e),e=i.parent().find(".wpforms-conditional-group").last().clone(),o=(e.find("tr").slice(1).remove(),e.find(".wpforms-conditional-field")),t=e.find(".wpforms-conditional-operator"),n=WPFormsConditionals.conditionalData(o),l=Number(n.groupID)+1,n=n.inputName+"["+l+"][0]";e.find("option:selected").prop("selected",!1),e.find(".value").empty().append(s("<select>")),o.attr("name",n+"[field]").attr("data-ruleid",0).attr("data-groupid",l),t.attr("name",n+"[operator]"),i.before(e)},conditionalData:function(e){e=s(e),e={fields:wpf.getFields(!1,!0),inputBase:e.closest(".wpforms-conditional-row").attr("data-input-name"),fieldID:e.closest(".wpforms-conditional-row").attr("data-field-id"),ruleID:e.attr("data-ruleid"),groupID:e.attr("data-groupid"),selectedID:e.find(":selected").val()};return e.inputName=e.inputBase+"[conditionals]",e.selectedID.length?e.field=wpf.getField(e.selectedID):e.field=!1,e}};return l}(document,(window,jQuery));WPFormsConditionals.init();