export default function(r,i){const s=wpforms_ai_form_generator,n={el:{},mouse:{},init(){n.el.$contentWrap=r.main.el.$generatorPanel.find(".wpforms-panel-content-wrap"),n.el.$content=n.el.$contentWrap.find(".wpforms-panel-content"),n.el.$emptyState=n.el.$content.find(".wpforms-panel-empty-state"),n.events()},events(){i(document).on("mousemove",e=>{n.mouse.x=e.pageX,n.mouse.y=e.pageY}),n.el.$contentWrap.on("scroll",n.closeTooltips)},update(){var e=r.state.aiResponse;if(e&&e.fields){r.state.isPreviewUpdate=!0,r.state.previewFields=[],n.clear(!1),n.el.$content.prepend(`<h2 class="wpforms-ai-form-generator-preview-title">${e.form_title??""}</h2>`);for(const o in e.fieldsOrder){var t=e.fieldsOrder[o];n.field(e.fields[t],o)}n.displaySubmit(e.settings?.submit_text??s.panel.submitButton)}},async field(t,e){var o=`
				<div id="wpforms-generator-field-${t.id??""}" class="wpforms-ai-form-generator-preview-field">
					<div class="placeholder"></div>
					<div class="wpforms-field wpforms-field-${t.type??""}"></div>
				</div>
			`,o=(n.el.$content.append(o),{action:"wpforms_get_ai_form_field_preview",nonce:s.nonce,field:t});await n.delay(300*e),i.post(s.ajaxUrl,o).done(function(e){e.success?n.displayField(e.data??"",t):wpf.debug("Form Generator AJAX error:",e.data.error??e.data)}).fail(function(e){wpf.debug("Form Generator AJAX error:",e.responseText??e.statusText)})},displayField(e,t){var o,i;!t.id&&0!==t.id||(i=(o=n.el.$content.find("#wpforms-generator-field-"+t.id)).find(".wpforms-field"),o.find(".placeholder").addClass("fade-out"),i.html(e??"").addClass("fade-in").toggleClass("wpforms-hidden",!e).toggleClass("required","1"===t.required),n.initTooltip(i),n.initPageBreak(i,t),r.state.previewFields.push(t.id),r.state.previewFields.length!==Object.keys(r.state.aiResponse?.fields).length)||(r.state.isPreviewUpdate=!1)},initPageBreak(e,t){"pagebreak"!==t.type||["top","bottom"].includes(t.position)||e.addClass("wpforms-pagebreak-normal")},initTooltip(e){var t={content:s.panel.tooltipTitle+"<br>"+s.panel.tooltipText,trigger:"manual",interactive:!0,animationDuration:100,delay:0,side:["top"],contentAsHTML:!0,functionPosition:(e,t,o)=>(o.coord.top=n.mouse.y-57,o.coord.left=n.mouse.x-130,o)};e.tooltipster(t),n.toggleTooltipOnClick(e)},toggleTooltipOnClick(t){t.on("click",()=>{n.closeTooltips();var e=t.tooltipster("status");t.tooltipster("closed"===e.state?"open":"close"),"closed"===e.state&&((e=t.tooltipster("instance"))._$tooltip.css({height:"auto"}),e._$tooltip.find(".tooltipster-arrow").css({left:"50%"}),setTimeout(function(){n.closeTooltips()},5e3))})},closeTooltips(){n.el.$content.find(".wpforms-field").each(function(){var e=i(this);e.hasClass("tooltipstered")&&e.parent().length&&e.tooltipster("close")})},displaySubmit(e){n.el.$content.append(`<button type="button" value="${e}" class="wpforms-ai-form-generator-preview-submit">${e}</button>`)},clear(e=!0){n.el.$content.find(".wpforms-ai-form-generator-preview-field").remove(),n.el.$content.find(".wpforms-ai-form-generator-preview-placeholder").remove(),n.el.$content.find(".wpforms-ai-form-generator-preview-title").remove(),n.el.$content.find(".wpforms-ai-form-generator-preview-submit").remove(),n.el.$emptyState.toggleClass("wpforms-hidden-strict",!e)},delay(t){return new Promise(e=>{setTimeout(e,t)})}};return n}