jQuery(document).ready(function(e){function t(){var t=e('input[name="chart-date_from"]').val(),a=e('input[name="chart-date_to"]').val(),n=[];e('input[name="chart-item[]"]:checked').each(function(){var t=e(this).attr("value"),a=e(this).attr("data-color");n.push({id:t,color:a})});var c=e('input[name="stats-options"]:checked').val(),h=e("#wpjms-job-dashboard");h.block({message:null,full:!1,overlayCSS:{background:"#fff",opacity:.6}}),wp.ajax.post("wpjms_job_dashboard_chart",{nonce:wpjms.ajax_nonce,date_from:t,date_to:a,stat_id:c,items:n}).done(function(t){h.height(h.height()+"px"),e("#wpjms_job_dashboard_chart").html(t),h.height("auto").unblock()}).fail(function(e){h.height(h.height()+"px"),h.html(e),h.height("auto").unblock()})}e.dateRangePickerLanguages={wpjms:drp_lang},e('input[name="chart-date-range"]').dateRangePicker({language:"wpjms",setValue:function(e){this.value=e},showShortcuts:!0,showTopbar:!0,singleMonth:!1,shortcuts:{"prev-days":[3,7,14],prev:["week","month"],"next-days":null,next:null},customShortcuts:[{name:wpjms.this_week,dates:function(){return[moment().day(0).toDate(),moment().day(6).toDate()]}},{name:wpjms.this_month,dates:function(){return[moment().startOf("month").toDate(),moment().endOf("month").toDate()]}}]}),e("body").on("datepicker-change",'input[name="chart-date-range"]',function(a,n){var c=new Date(n.date1),h=new Date(n.date2),i=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2),o=h.getFullYear()+"-"+("0"+(h.getMonth()+1)).slice(-2)+"-"+("0"+h.getDate()).slice(-2);e('input[name="chart-date_from"]').val(i),e('input[name="chart-date_to"]').val(o),t()}),e("body").on("change",'input[name="stats-options"]',function(){var a=e(this).parents("li.wpjms-stats-option");e(this).is(":checked")?(a.siblings("li").data("checked","unchecked"),a.siblings("li").attr("data-checked","unchecked"),a.data("checked","checked"),a.attr("data-checked","checked")):(a.siblings("li").data("checked","checked"),a.siblings("li").attr("data-checked","checked"),a.data("checked","unchecked"),a.attr("data-checked","unchecked")),t()}),e("body").on("change",'input[name="chart-item[]"]',function(){var a=e(this).parents("li.chart-item");e(this).is(":checked")?(a.data("checked","checked"),a.attr("data-checked","checked")):(a.data("checked","unchecked"),a.attr("data-checked","unchecked")),t()}),e("#wpjms-legend-search").autocomplete({source:function(t,a){if(t.term.length<3)a({value:wpjms.min_char});else{var n=[];e("#wpjms-chart-legend-list").find("li").each(function(){n.push(e(this).data("id"))}),wp.ajax.post("wpjms_legend_search",{nonce:wpjms.ajax_nonce,exclude:n,keyword:t.term}).done(function(e){a(e)})}},minLength:0,select:function(a,n){return void 0!==n.item.html&&(e("#wpjms-chart-legend-list").append(n.item.html),t()),e(this).val(""),!1}}).bind("focus",function(){e(this).autocomplete("search")}),e("body").on("click",".remove-chart-legend-item",function(a){a.preventDefault(),e(this).parents("li.chart-item").remove(),t()}),t()});