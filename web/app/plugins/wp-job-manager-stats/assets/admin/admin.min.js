jQuery(document).ready(function($){$('body').on('click','#doaction',function(e){var action=$('#bulk-action-selector-top').val();if('wpjms_stats'==action){e.preventDefault();refresh_chart()}});$('body').on('click','#doaction2',function(e){var action=$('#bulk-action-selector-bottom').val();if('wpjms_stats'==action){e.preventDefault();refresh_chart()}});$.dateRangePickerLanguages={'wpjms':drp_lang};$('input[name="chart-date-range"]').dateRangePicker({language:'wpjms',setValue:function(s){this.value=s},showShortcuts:!0,showTopbar:!0,singleMonth:!1,shortcuts:{'prev-days':[3,7,14],'prev':['week','month'],'next-days':null,'next':null,},customShortcuts:[{name:wpjms.this_week,dates:function(){var start=moment().day(0).toDate();var end=moment().day(6).toDate();return[start,end]}},{name:wpjms.this_month,dates:function(){var start=moment().startOf('month').toDate();var end=moment().endOf('month').toDate();return[start,end]}},]});$('body').on('datepicker-change','input[name="chart-date-range"]',function(e,obj){var date1=new Date(obj.date1);var date2=new Date(obj.date2);var date_from=date1.getFullYear()+'-'+("0"+(date1.getMonth()+1)).slice(-2)+'-'+("0"+date1.getDate()).slice(-2);var date_to=date2.getFullYear()+'-'+("0"+(date2.getMonth()+1)).slice(-2)+'-'+("0"+date2.getDate()).slice(-2);$('input[name="chart-date_from"]').val(date_from);$('input[name="chart-date_to"]').val(date_to);refresh_chart()});$('body').on('change','select[name="stats-options"]',function(){refresh_chart()});$('body').on('click','.wpjms-box-close,#wpjms-box-overlay',function(e){e.preventDefault();$("#wpjms-box,#wpjms-box-overlay").hide()});function refresh_chart(){var items=[];$('input[name="post[]"]:checked').each(function(){var id=$(this).attr('value');items.push(id)});if(items.length){var date_from=$('input[name="chart-date_from"]').val();var date_to=$('input[name="chart-date_to"]').val();var stat_id=$('select[name="stats-options"]').val();$("#wpjms-box-overlay, #wpjms-box").show();$("#wpjms-box-content").css("height",($('#wpjms-box').height()-$('.wpjms-box-close').height())+"px");$(window).resize(function(){$("#wpjms-box-content").css("height",($('#wpjms-box').height()-$('.wpjms-box-close').height())+"px")});var wrap=$('#wpjms-box-content');wrap.block({message:null,full:!1,overlayCSS:{background:'#fff',opacity:0.6}});wp.ajax.post('wpjms_admin_chart',{nonce:wpjms.ajax_nonce,date_from:date_from,date_to:date_to,stat_id:stat_id,items:items,}).done(function(data){$('#wpjms_admin_chart').html(data);wrap.unblock()}).fail(function(data){wrap.unblock()})}}})