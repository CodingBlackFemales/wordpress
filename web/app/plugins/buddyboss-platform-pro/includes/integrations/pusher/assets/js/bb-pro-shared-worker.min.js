var clients=[],pusher=!1,channels=[],current_user_id=0;function onMessage(e){switch(e.data.type){case"pusher_init":pusherInit(e.data);break;case"pusher_subscribe":pusherSubscribe(e.data);break;case"pusher_unsubscribe":pusherUnsubscribe(e.data);break;case"pusher_send_event":pusherChannelTrigger(e.data);break;default:sendMessages(e.data.type,e.data)}}function pusherInit(e){var s=e.data.options;return pusher&&current_user_id===e.loggedin_user_id||(current_user_id=e.current_user_id,importScripts("https://js.pusher.com/7.0/pusher.worker.min.js"),importScripts(s.authorizer),s.authorizer=PusherBatchAuthorizer,pusher=new Pusher(e.data.app_key,s),sendMessages("pusher_init_first",{success:!0})),sendMessages("pusher_init",{success:!0}),send_channels(),pusher}function send_channels(){sendMessages("pusher_channels",{channels:pusher.channels})}function pusherSubscribe(n){current_user_id===n.current_user_id&&void 0===channels[n.data.channel_name]&&(channels[n.data.channel_name]=pusher.subscribe(n.data.channel_name),channels[n.data.channel_name].bind_global(function(e,s){sendMessages("pusher_event",{channel_name:n.data.channel_name,event:e,data:s,user_id:current_user_id})}))}function pusherUnsubscribe(e){current_user_id===e.current_user_id&&void 0!==channels[e.data.channel_name]&&pusher.unsubscribe(e.data.channel_name)}function pusherChannelTrigger(e){current_user_id===e.current_user_id&&void 0!==channels[e.data.channel_name]&&channels[e.data.channel_name].trigger(e.data.event,e.data.data)}function sendMessages(s,n){clients.forEach(function(e){e.postMessage({type:s,data:n})})}self.addEventListener("connect",function(e){e=e.ports[0];clients.push(e),e.onmessage=onMessage,e.start()});