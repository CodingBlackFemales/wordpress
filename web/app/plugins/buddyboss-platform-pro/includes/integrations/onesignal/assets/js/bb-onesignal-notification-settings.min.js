window.bp=window.bp||{},function(s){bp.OneSignal_Common={start:function(){this.setupGlobals(),this.addListeners(),this.validateWebPush(),this.validateAutoPrompt(),this.validateSoftPrompt(),this.uploadAttachment()},setupGlobals:function(){jQuery(function(){bp.OneSignal_Common.validateWebPush(),bp.OneSignal_Common.validateAutoPrompt(),bp.OneSignal_Common.validateSoftPrompt()})},addListeners:function(){s(document).on("change","#bb-onesignal-enable-soft-prompt",this.validateSoftPrompt.bind(this)),s(document).on("change","#bb-onesignal-request-permission",this.validateRequestPermission.bind(this)),s(document).on("change","#bb-onesignal-enabled-web-push",this.enableWebPush.bind(this)),s(document).on("click",".bb-onesignal-enable-soft-prompt .bb-learn-more",this.softPromptLearnMore.bind(this)),s(document).on("keyup","#bb-onesignal-enable-soft-prompt-message",this.updateSoftPromptMessage.bind(this)),s(document).on("keyup","#bb-onesignal-enable-soft-prompt-allow-button",this.updateSoftPromptAllowButton.bind(this)),s(document).on("keyup","#bb-onesignal-enable-soft-prompt-cancel-button",this.updateSoftPromptCancelButton.bind(this)),s(document).on("click",".bb-hide-pw",this.TogglePasswordField.bind(this))},validateSoftPrompt:function(){jQuery("#bb-onesignal-request-permission").is(":checked")&&jQuery("#bb-onesignal-enabled-web-push").is(":checked")&&s("#bb-onesignal-enable-soft-prompt").is(":checked")?s(".bb-onesignal-enable-soft-prompt-extra-fields").removeClass("bp-hide"):s(".bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")},validateRequestPermission:function(e){s(e.currentTarget).is(":checked")?s('select[name="bb-onesignal-permission-validate"]').prop("disabled",!1):s('select[name="bb-onesignal-permission-validate"]').prop("disabled",!0),bp.OneSignal_Common.validateAutoPrompt()},enableWebPush:function(){bp.OneSignal_Common.validateWebPush()},validateWebPush:function(){jQuery("#bb-onesignal-enabled-web-push").is(":checked")?(jQuery(".bb-onesignal-request-permission, .bb-onesignal-default-notification-icon, .bb-onesignal-web-push-skip-active-members").removeClass("bp-hide"),jQuery("#bb-onesignal-request-permission").is(":checked")?(jQuery(".bb-onesignal-enable-soft-prompt").removeClass("bp-hide"),jQuery("#bb-onesignal-enable-soft-prompt").is(":checked")&&jQuery(".bb-onesignal-enable-soft-prompt-extra-fields").removeClass("bp-hide")):jQuery(".bb-onesignal-enable-soft-prompt, .bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")):jQuery(".bb-onesignal-request-permission, .bb-onesignal-default-notification-icon, .bb-onesignal-enable-soft-prompt, .bb-onesignal-enable-soft-prompt-extra-fields, .bb-onesignal-web-push-skip-active-members").addClass("bp-hide")},validateAutoPrompt:function(){jQuery("#bb-onesignal-request-permission").is(":checked")&&jQuery("#bb-onesignal-enabled-web-push").is(":checked")?(jQuery(".bb-onesignal-enable-soft-prompt").removeClass("bp-hide"),jQuery("#bb-onesignal-enable-soft-prompt").is(":checked")&&jQuery(".bb-onesignal-enable-soft-prompt-extra-fields").removeClass("bp-hide")):jQuery(".bb-onesignal-enable-soft-prompt, .bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")},softPromptLearnMore:function(){return s(".bb-onesignal-enable-soft-prompt .small-text").addClass("bp-hide"),s(".bb-onesignal-enable-soft-prompt .full-text").removeClass("bp-hide"),!1},updateSoftPromptMessage:function(e){var t=s(e.currentTarget),a=t.attr("placeholder"),t=t.val();t.length<1&&(t=a),s(".bb-onesignal-enable-soft-prompt-extra-fields .soft-prompt-text").text(t),bp.OneSignal_Common.validateCharacterLimit(e)},updateSoftPromptAllowButton:function(e){var t=s(e.currentTarget),a=t.attr("placeholder"),t=t.val();t.length<1&&(t=a),s(".bb-onesignal-enable-soft-prompt-extra-fields .allow-soft-prompt-button").text(t),bp.OneSignal_Common.validateCharacterLimit(e)},updateSoftPromptCancelButton:function(e){var t=s(e.currentTarget),a=t.attr("placeholder"),t=t.val();t.length<1&&(t=a),s(".bb-onesignal-enable-soft-prompt-extra-fields .cancel-soft-prompt-button").text(t),bp.OneSignal_Common.validateCharacterLimit(e)},uploadAttachment:function(){var n="",e=(s(".bbpro-upload-attachment").on("click",".bb-attachment-user-edit",function(){var e=(n=s(this)).parents(".bbpro-upload-attachment").find(".bbpro-attachment-status");0<e.length&&e.find(".bbpro-attachment-upload-feedback").length&&(e.find(".bbpro-attachment-upload-feedback").removeClass("success error").html(""),e.hide()),setTimeout(function(){(0<jQuery(document).find("#TB_ajaxContent .bp-avatar-status .error").length||jQuery(document).find("#TB_ajaxContent .bp-avatar-status .warning").length<=0)&&(jQuery(document).find("#TB_ajaxContent .bp-avatar-status").empty(),jQuery(document).find("#TB_ajaxContent .bp-avatar-status").append('<p class="warning">'+BP_Uploader.strings.avatar_size_warning+"<br></p>"))},50)}),s(".bbpro-upload-attachment").on("click",".bb-attachment-user-edit, .bbpro-img-remove-button",function(){var e=s(this).parents(".bbpro-upload-attachment");0<e.length&&(e=e.data("object"),BP_Uploader.settings.defaults.multipart_params.bp_params.object=e)}),s(document).ajaxSuccess(function(e,t,a){a.hasOwnProperty("data")&&"string"==typeof a.data&&0<a.data.search("action=bp_avatar_set")&&a.data.search("object=notification")&&(a=JSON.parse(t.responseText),t=BP_Uploader.strings.default_error,void 0!==a.success&&!1===a.success&&(void 0!==a.data&&void 0!==a.data.feedback_code&&(t=BP_Uploader.strings.feedback_messages[a.data.feedback_code]),0<(a=n.parents(".bbpro-upload-attachment").find(".bbpro-attachment-status")).length)&&a.find(".bbpro-attachment-upload-feedback").length&&(a.find(".bbpro-attachment-upload-feedback").removeClass("success error").addClass("error").html(t),a.show()),s(e.currentTarget.activeElement).find("#TB_closeWindowButton").trigger("click"),n.html(n.data("upload")))}),s(document).ajaxError(function(e,t,a){a.hasOwnProperty("data")&&"string"==typeof a.data&&0<a.data.search("action=bp_avatar_set")&&a.data.search("object=notification")&&(s(e.currentTarget.activeElement).find("#TB_closeWindowButton").trigger("click"),n.html(n.data("upload")))}),s(document).ajaxSend(function(e,t,a){a.hasOwnProperty("data")&&"string"==typeof a.data&&0<a.data.search("action=bp_avatar_set")&&a.data.search("object=notification")&&(s(document).find("#TB_closeWindowButton").trigger("click"),n.html(n.data("uploading")))}),document.querySelectorAll(".bbpro-attachment-upload-container .bb-upload-preview")),t=new MutationObserver(function(e){e.forEach(function(e){var t;e.attributeName.includes("src")&&(""===(t=s(e.target).attr("src"))?(s(e.target).addClass("bp-hide"),s(e.target).next(".bb-default-custom-avatar-field").val(""),s(e.target).parents(".bbpro-upload-attachment").find(".bbpro-img-remove-button").addClass("bp-hide")):(s(e.target).removeClass("bp-hide"),s(e.target).next(".bb-default-custom-avatar-field").val(t),s(e.target).parents(".bbpro-upload-attachment").find(".bbpro-img-remove-button").removeClass("bp-hide")))})});e.forEach(function(e){t.observe(e,{attributes:!0})}),s(".bbpro-upload-attachment").on("click","a.bbpro-img-remove-button",function(e){var a,t,n,o;e.preventDefault(),confirm(BP_Confirm.are_you_sure)&&(e=(a=s(this)).parents("tr"),t=e.find(".bbpro-upload-attachment"),n=e.find(".bbpro-attachment-status"),e=BP_Uploader.settings.defaults.multipart_params.bp_params.item_id,o=BP_Uploader.settings.defaults.multipart_params.bp_params.object,a.html(a.data("removing")),n.hide(),n.find(".bp-feedback").removeClass("success error"),bp.ajax.post("bp_avatar_delete",{json:!0,item_id:e,item_type:BP_Uploader.settings.defaults.multipart_params.bp_params.item_type,object:o,nonce:BP_Uploader.settings.defaults.multipart_params.bp_params.nonces.remove}).done(function(e){a.html(a.data("remove")),s("."+o+"-"+e.item_id+"-avatar").each(function(){s(this).prop("src",e.avatar)}),t.find(".bb-upload-container img").prop("src",e.avatar).addClass("bp-hide"),setTimeout(function(){t.find(".bbpro-img-remove-button").length&&t.find(".bbpro-img-remove-button").addClass("bp-hide")},50)}).fail(function(e){var t=BP_Uploader.strings.default_error;a.html(a.data("remove")),_.isUndefined(e)||(t=BP_Uploader.strings.feedback_messages[e.feedback_code]),n.find(".bp-feedback").removeClass("success error").addClass("error").find("p").html(t),n.show()}))})},validateCharacterLimit:function(e){var e=s(e.currentTarget),t=e.val().length;e.parent().find(".description .current").text(t),0===t?e.parent().find(".description:not(.soft_prompt_label_header)").addClass("bp-hide"):e.parent().find(".description:not(.soft_prompt_label_header)").removeClass("bp-hide")},TogglePasswordField:function(e){e=s(e.currentTarget).parent(".password-toggle").find("input");"password"===e.attr("type")?e.attr("type","text"):e.attr("type","password")}},bp.OneSignal_Common.start()}((bp,jQuery));