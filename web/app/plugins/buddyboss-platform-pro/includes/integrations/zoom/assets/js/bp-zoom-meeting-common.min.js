window.bp=window.bp||{},function(c){bp.Zoom_Common={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.account_email_xhr=null,this.secret_token_xhr=null,this.credential_xhr=null},addListeners:function(){c(document).on("change","#bp-edit-group-zoom",this.toggleGroupSettings.bind(this)),c(document).on("click",".bp-step-nav li > a, .bp-step-actions > span",this.bpStepsNavigate.bind(this)),c(window).on("keyup",this.zoomInstructionNavigate.bind(this)),c(document).find(".bb-group-zoom-settings-container").length&&c(document).on("click","form#group-settings-form button.bb-save-settings",this.zoomSettingsSave.bind(this)),void 0!==jQuery.fn.magnificPopup&&jQuery(".show-zoom-instructions").magnificPopup({type:"inline",midClick:!0}),c(document).on("click",".bb-zoom-setting-tab .bb-zoom-setting-tabs a",this.switchedTab.bind(this)),c(document).on("change","#bb-group-zoom-s2s-account-id, #bb-group-zoom-s2s-client-id, #bb-group-zoom-s2s-client-secret",this.fetchZoomAccounts.bind(this)),c(document).on("click",".bb-pro-tabs-list li",this.switchedTab.bind(this)),c(document).on("change","#s2s-account-id, #s2s-client-id, #s2s-client-secret",this.fetchZoomAccounts.bind(this)),c(document).on("change",".postbox-container #bp-edit-group-zoom",this.toggleAdminGroupSettings.bind(this)),c(document).on("change","#bb-group-zoom-s2s-secret-token-popup",this.updateGroupSecretToken.bind(this)),c(document).on("change","#bb-group-zoom-s2s-account-id-popup, #bb-group-zoom-s2s-client-id-popup, #bb-group-zoom-s2s-client-secret-popup",this.fetchZoomAccounts.bind(this)),c(document).on("click",".bp-zoom-group-show-instructions .save-settings",this.submitGroupZoomWizard.bind(this)),c(document).on("keyup change",".zoom-group-instructions-cloned-input",this.copyInputData.bind(this)),c(document).on("keyup change",".zoom-group-instructions-main-input",this.copyMainInputData.bind(this)),c(window).on("load",function(){""!==window.location.hash&&0<c('a[href="'+window.location.hash+'"]').length&&void 0!==jQuery.fn.magnificPopup&&(c('a[href="'+window.location.hash+'"]').trigger("click"),window.location.hash="")})},switchedTab:function(e){e=c(e.currentTarget).data("value");c('input[name="bb-zoom-tab"]').val(e)},toggleGroupSettings:function(e){var o=c(e.target);e.preventDefault(),o.is(":checked")?c('form[name="group-settings-form"] .bb-zoom-setting-tab').removeClass("bp-hide"):c('form[name="group-settings-form"] .bb-zoom-setting-tab').addClass("bp-hide")},bpStepsNavigate:function(e){e.preventDefault();var o,e=c(e.currentTarget),t=(e.closest(".bp-step-nav").length?(e.closest("li").addClass("selected").siblings().removeClass("selected"),e.closest(".bp-step-nav-main").find(".bp-step-block"+e.attr("href")).addClass("selected").siblings().removeClass("selected")):e.closest(".bp-step-actions").length&&(t=e.closest(".bp-step-nav-main").find(".bp-step-block.selected"),o=e.closest(".bp-step-nav-main").find(".bp-step-nav li.selected"),e.hasClass("bp-step-prev")?(t.removeClass("selected").prev().addClass("selected"),o.removeClass("selected").prev().addClass("selected")):e.hasClass("bp-step-next")&&(t.removeClass("selected").next().addClass("selected"),o.removeClass("selected").next().addClass("selected"))),e.closest(".bp-step-nav-main").find(".bp-step-nav li").length);0===e.closest(".bp-step-nav-main").find(".bp-step-nav li.selected").index()?e.closest(".bp-step-nav-main").find(".bp-step-actions .bp-step-prev").hide():e.closest(".bp-step-nav-main").find(".bp-step-actions .bp-step-prev").show(),e.closest(".bp-step-nav-main").find(".bp-step-nav li.selected").index()===t-1?e.closest(".bp-step-nav-main").addClass("last-tab").find(".bp-step-actions .bp-step-next").hide():e.closest(".bp-step-nav-main").removeClass("last-tab").find(".bp-step-actions .bp-step-next").show()},zoomSettingsSave:function(e){c(e.target).addClass("loading")},zoomInstructionNavigate:function(e){c(".bp-zoom-group-show-instructions").length&&(39===e.keyCode?c(".bp-zoom-group-show-instructions .bp-step-actions .bp-step-next:visible").trigger("click"):37===e.keyCode&&c(".bp-zoom-group-show-instructions .bp-step-actions .bp-step-prev:visible").trigger("click"))},fetchZoomAccounts:function(e){var o=c("#s2s-account-id").val(),t=c("#s2s-client-id").val(),n=c("#s2s-client-secret").val(),s=c("body"),a=c(document).find(".bb-zoom_account-email #account-email"),i=0;if(s.hasClass("groups")&&s.hasClass("zoom")&&(s="",0<c(e.target).closest(".bb-group-zoom-wizard-credentials").length&&(s="-popup"),i=c("#group-id").val(),a=c("#bb-group-zoom-s2s-api-email"),o=c("#bb-group-zoom-s2s-account-id"+s).val(),t=c("#bb-group-zoom-s2s-client-id"+s).val(),n=c("#bb-group-zoom-s2s-client-secret"+s).val()),e.preventDefault(),""===o||""===t||""===n)return!1;c(document).find(".bb-zoom_account-email").addClass("loading"),bp.Zoom_Common.account_email_xhr&&bp.Zoom_Common.account_email_xhr.abort(),bp.Zoom_Common.account_email_xhr=c.ajax({type:"POST",url:bpZoomMeetingCommonVars.ajax_url,data:{action:"zoom_api_get_account_emails",account_id:o,client_id:t,client_secret:n,group_id:i,_nonce:bpZoomMeetingCommonVars.fetch_account_nonce},success:function(e){var o;void 0!==e.data&&e.data.email_accounts&&(c(document).find(".bb-zoom_account-email").removeClass("loading"),a.html(e.data.email_accounts),o="",0<i&&(o=c("#bb-group-zoom-s2s-api-email-popup")).html(e.data.email_accounts),""!==e.data.field_disabled?(a.addClass(e.data.field_disabled),""!==o&&o.addClass(e.data.field_disabled)):(a.removeClass("is-disabled"),""!==o&&o.removeClass("is-disabled")))}})},toggleAdminGroupSettings:function(e){var o=c(e.target);e.preventDefault(),o.is(":checked")?c("#bp-group-zoom-settings-connection-type, #bp-group-zoom-settings-additional").removeClass("bp-hide"):c("#bp-group-zoom-settings-connection-type, #bp-group-zoom-settings-additional").addClass("bp-hide")},updateGroupSecretToken:function(e){var o=c(e.target),t=c("#group-id").val(),o=o.val();if(e.preventDefault(),""===o||""===t)return!1;bp.Zoom_Common.secret_token_xhr&&bp.Zoom_Common.secret_token_xhr.abort(),bp.Zoom_Common.secret_token_xhr=c.ajax({type:"POST",url:bpZoomMeetingCommonVars.ajax_url,data:{action:"zoom_group_update_secret_token",secret_token:o,group_id:t,_nonce:bpZoomMeetingCommonVars.update_secret_token_nonce},success:function(){}})},submitGroupZoomWizard:function(e){var o=c("#bb-group-zoom-s2s-account-id-popup").val(),t=c("#bb-group-zoom-s2s-client-id-popup").val(),n=c("#bb-group-zoom-s2s-client-secret-popup").val(),s=c("#bb-group-zoom-s2s-api-email-popup").val(),a=c(e.target),i=c("#group-id").val();e.preventDefault(),bp.Zoom_Common.credential_xhr&&bp.Zoom_Common.credential_xhr.abort(),a.addClass("loading").css("pointer-events","none"),bp.Zoom_Common.credential_xhr=c.ajax({type:"POST",url:bpZoomMeetingCommonVars.ajax_url,data:{action:"zoom_api_submit_group_zoom_credentials",account_id:o,client_id:t,client_secret:n,account_email:s,group_id:i,_nonce:bpZoomMeetingCommonVars.submit_zoom_wizard_nonce},success:function(e){a.removeClass("loading").css("pointer-events",""),void 0!==e.data&&("success"===e.data.type&&(c("#bp-edit-group-zoom").is(":checked")||(c("#bp-edit-group-zoom").prop("checked",!0),c(".bb-zoom-setting-tab").removeClass("bp-hide")),c(".group-zoom-sidewide-deprecated-notice").remove(),void 0!==jQuery.fn.magnificPopup)&&(c.magnificPopup.close(),c("body").css("overflow","")),e.data.notice)&&c(".bb-group-zoom-s2s-notice").html(e.data.notice)}})},copyInputData:function(e){"SELECT"===c(e.currentTarget).prop("tagName")?c(document).find("select[name="+c(e.currentTarget).attr("name").replace("-popup","")+"]").val(c(e.currentTarget).val()).change():c(document).find("input[name="+c(e.currentTarget).attr("name").replace("-popup","")+"]").val(c(e.currentTarget).val())},copyMainInputData:function(e){"SELECT"===c(e.currentTarget).prop("tagName")?c(document).find("select[name="+c(e.currentTarget).attr("name")+"-popup]").val(c(e.currentTarget).val()).change():c(document).find("input[name="+c(e.currentTarget).attr("name")+"-popup]").val(c(e.currentTarget).val())}},bp.Zoom_Common.start()}((bp,jQuery));