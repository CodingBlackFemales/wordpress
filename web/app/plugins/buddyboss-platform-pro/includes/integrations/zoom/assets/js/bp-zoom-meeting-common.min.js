window.bp=window.bp||{},function(c){bp.Zoom_Common={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.account_email_xhr=null,this.secret_token_xhr=null,this.credential_xhr=null},addListeners:function(){c(document).on("change","#bp-edit-group-zoom",this.toggleGroupSettings.bind(this)),c(document).on("click",".bp-step-nav li > a, .bp-step-actions > span",this.bpStepsNavigate.bind(this)),c(window).on("keyup",this.zoomInstructionNavigate.bind(this)),c(document).find(".bb-group-zoom-settings-container").length&&c(document).on("click","form#group-settings-form button.bb-save-settings",this.zoomSettingsSave.bind(this)),void 0!==jQuery.fn.magnificPopup&&jQuery(".show-zoom-instructions").magnificPopup({type:"inline",midClick:!0}),c(document).on("click",".bb-zoom-setting-tab .bb-zoom-setting-tabs a",this.switchedTab.bind(this)),c(document).on("change","#bb-group-zoom-s2s-account-id, #bb-group-zoom-s2s-client-id, #bb-group-zoom-s2s-client-secret",this.fetchZoomAccounts.bind(this)),c(document).on("click",".bb-pro-tabs-list li",this.switchedTab.bind(this)),c(document).on("change","#s2s-account-id, #s2s-client-id, #s2s-client-secret",this.fetchZoomAccounts.bind(this)),c(document).on("change",".postbox-container #bp-edit-group-zoom",this.toggleAdminGroupSettings.bind(this)),c(document).on("change",'.postbox-container input[name="bp-group-zoom-connection-type"]',this.toggleAdminGroupJWTNotice.bind(this)),c(document).on("change","#bb-group-zoom-s2s-secret-token-popup",this.updateGroupSecretToken.bind(this)),c(document).on("change","#bb-group-zoom-s2s-account-id-popup, #bb-group-zoom-s2s-client-id-popup, #bb-group-zoom-s2s-client-secret-popup",this.fetchZoomAccounts.bind(this)),c(document).on("click",".bp-zoom-group-show-instructions .save-settings",this.submitGroupZoomWizard.bind(this)),c(document).on("keyup change",".zoom-group-instructions-cloned-input",this.copyInputData.bind(this)),c(document).on("keyup change",".zoom-group-instructions-main-input",this.copyMainInputData.bind(this)),c(window).on("load",function(){""!==window.location.hash&&0<c('a[href="'+window.location.hash+'"]').length&&void 0!==jQuery.fn.magnificPopup&&(c('a[href="'+window.location.hash+'"]').trigger("click"),window.location.hash="")})},switchedTab:function(o){o=c(o.currentTarget).data("value");c('input[name="bb-zoom-tab"]').val(o)},toggleGroupSettings:function(o){var e=c(o.target);o.preventDefault(),e.is(":checked")?c('form[name="group-settings-form"] .bb-zoom-setting-tab').removeClass("bp-hide"):c('form[name="group-settings-form"] .bb-zoom-setting-tab').addClass("bp-hide")},bpStepsNavigate:function(o){o.preventDefault();var e,o=c(o.currentTarget),t=(o.closest(".bp-step-nav").length?(o.closest("li").addClass("selected").siblings().removeClass("selected"),o.closest(".bp-step-nav-main").find(".bp-step-block"+o.attr("href")).addClass("selected").siblings().removeClass("selected")):o.closest(".bp-step-actions").length&&(t=o.closest(".bp-step-nav-main").find(".bp-step-block.selected"),e=o.closest(".bp-step-nav-main").find(".bp-step-nav li.selected"),o.hasClass("bp-step-prev")?(t.removeClass("selected").prev().addClass("selected"),e.removeClass("selected").prev().addClass("selected")):o.hasClass("bp-step-next")&&(t.removeClass("selected").next().addClass("selected"),e.removeClass("selected").next().addClass("selected"))),o.closest(".bp-step-nav-main").find(".bp-step-nav li").length);0===o.closest(".bp-step-nav-main").find(".bp-step-nav li.selected").index()?o.closest(".bp-step-nav-main").find(".bp-step-actions .bp-step-prev").hide():o.closest(".bp-step-nav-main").find(".bp-step-actions .bp-step-prev").show(),o.closest(".bp-step-nav-main").find(".bp-step-nav li.selected").index()===t-1?o.closest(".bp-step-nav-main").addClass("last-tab").find(".bp-step-actions .bp-step-next").hide():o.closest(".bp-step-nav-main").removeClass("last-tab").find(".bp-step-actions .bp-step-next").show()},zoomSettingsSave:function(o){c(o.target).addClass("loading")},zoomInstructionNavigate:function(o){c(".bp-zoom-group-show-instructions").length&&(39===o.keyCode?c(".bp-zoom-group-show-instructions .bp-step-actions .bp-step-next:visible").trigger("click"):37===o.keyCode&&c(".bp-zoom-group-show-instructions .bp-step-actions .bp-step-prev:visible").trigger("click"))},fetchZoomAccounts:function(o){var e=c("#s2s-account-id").val(),t=c("#s2s-client-id").val(),n=c("#s2s-client-secret").val(),s=c("body"),a=c(document).find(".bb-zoom_account-email #account-email"),i=0;if(s.hasClass("groups")&&s.hasClass("zoom")&&(s="",0<c(o.target).closest(".bb-group-zoom-wizard-credentials").length&&(s="-popup"),i=c("#group-id").val(),a=c("#bb-group-zoom-s2s-api-email"),e=c("#bb-group-zoom-s2s-account-id"+s).val(),t=c("#bb-group-zoom-s2s-client-id"+s).val(),n=c("#bb-group-zoom-s2s-client-secret"+s).val()),o.preventDefault(),""===e||""===t||""===n)return!1;c(document).find(".bb-zoom_account-email").addClass("loading"),bp.Zoom_Common.account_email_xhr&&bp.Zoom_Common.account_email_xhr.abort(),bp.Zoom_Common.account_email_xhr=c.ajax({type:"POST",url:bpZoomMeetingCommonVars.ajax_url,data:{action:"zoom_api_get_account_emails",account_id:e,client_id:t,client_secret:n,group_id:i,_nonce:bpZoomMeetingCommonVars.fetch_account_nonce},success:function(o){var e;void 0!==o.data&&o.data.email_accounts&&(c(document).find(".bb-zoom_account-email").removeClass("loading"),a.html(o.data.email_accounts),e="",0<i&&(e=c("#bb-group-zoom-s2s-api-email-popup")).html(o.data.email_accounts),""!==o.data.field_disabled?(a.addClass(o.data.field_disabled),""!==e&&e.addClass(o.data.field_disabled)):(a.removeClass("is-disabled"),""!==e&&e.removeClass("is-disabled")))}})},toggleAdminGroupSettings:function(o){var e=c(o.target);o.preventDefault(),e.is(":checked")?c("#bp-group-zoom-settings-connection-type, #bp-group-zoom-settings-additional").removeClass("bp-hide"):c("#bp-group-zoom-settings-connection-type, #bp-group-zoom-settings-additional").addClass("bp-hide")},toggleAdminGroupJWTNotice:function(o){o.preventDefault(),"group"===c('input[name="bp-group-zoom-connection-type"]:checked').val()?c("#bb-zoom-group-admin-jwt-notice").removeClass("bp-hide"):c("#bb-zoom-group-admin-jwt-notice").addClass("bp-hide")},updateGroupSecretToken:function(o){var e=c(o.target),t=c("#group-id").val(),e=e.val();if(o.preventDefault(),""===e||""===t)return!1;bp.Zoom_Common.secret_token_xhr&&bp.Zoom_Common.secret_token_xhr.abort(),bp.Zoom_Common.secret_token_xhr=c.ajax({type:"POST",url:bpZoomMeetingCommonVars.ajax_url,data:{action:"zoom_group_update_secret_token",secret_token:e,group_id:t,_nonce:bpZoomMeetingCommonVars.update_secret_token_nonce},success:function(){}})},submitGroupZoomWizard:function(o){var e=c("#bb-group-zoom-s2s-account-id-popup").val(),t=c("#bb-group-zoom-s2s-client-id-popup").val(),n=c("#bb-group-zoom-s2s-client-secret-popup").val(),s=c("#bb-group-zoom-s2s-api-email-popup").val(),a=c(o.target),i=c("#group-id").val();o.preventDefault(),bp.Zoom_Common.credential_xhr&&bp.Zoom_Common.credential_xhr.abort(),a.addClass("loading").css("pointer-events","none"),bp.Zoom_Common.credential_xhr=c.ajax({type:"POST",url:bpZoomMeetingCommonVars.ajax_url,data:{action:"zoom_api_submit_group_zoom_credentials",account_id:e,client_id:t,client_secret:n,account_email:s,group_id:i,_nonce:bpZoomMeetingCommonVars.submit_zoom_wizard_nonce},success:function(o){a.removeClass("loading").css("pointer-events",""),void 0!==o.data&&("success"===o.data.type&&(c("#bp-edit-group-zoom").is(":checked")||(c("#bp-edit-group-zoom").prop("checked",!0),c(".bb-zoom-setting-tab").removeClass("bp-hide")),c(".group-zoom-sidewide-deprecated-notice").remove(),void 0!==jQuery.fn.magnificPopup)&&(c.magnificPopup.close(),c("body").css("overflow","")),o.data.notice)&&c(".bb-group-zoom-s2s-notice").html(o.data.notice)}})},copyInputData:function(o){"SELECT"===c(o.currentTarget).prop("tagName")?c(document).find("select[name="+c(o.currentTarget).attr("name").replace("-popup","")+"]").val(c(o.currentTarget).val()).change():c(document).find("input[name="+c(o.currentTarget).attr("name").replace("-popup","")+"]").val(c(o.currentTarget).val())},copyMainInputData:function(o){"SELECT"===c(o.currentTarget).prop("tagName")?c(document).find("select[name="+c(o.currentTarget).attr("name")+"-popup]").val(c(o.currentTarget).val()).change():c(document).find("input[name="+c(o.currentTarget).attr("name")+"-popup]").val(c(o.currentTarget).val())}},bp.Zoom_Common.start()}((bp,jQuery));