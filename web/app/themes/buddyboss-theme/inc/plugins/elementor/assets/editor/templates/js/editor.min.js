/*! 
 * BuddyBoss Theme JavaScript Library 
 * @package BuddyBoss Theme 
 */
!function(i){"use strict";var a,r,n=window.BBElementorSectionsData||{};a={modal:!(r={ModalLayoutView:null,ModalHeaderView:null,ModalLoadingView:null,ModalBodyView:null,ModalErrorView:null,LibraryCollection:null,ModalCollectionView:null,ModalTabsCollection:null,ModalTabsCollectionView:null,FiltersCollectionView:null,FiltersItemView:null,ModalTabsItemView:null,ModalTemplateItemView:null,ModalInsertTemplateBehavior:null,ModalTemplateModel:null,CategoriesCollection:null,ModalHeaderLogo:null,TabModel:null,CategoryModel:null,TemplatesEmptyView:null,TemplateSearchCollectionView:null,init:function(){var o=this;o.ModalTemplateModel=Backbone.Model.extend({defaults:{template_id:0,title:"",thumbnail:"",source:"",categories:[]}}),o.ModalHeaderView=Marionette.LayoutView.extend({id:"bbelementor-template-modal-header",template:"#tmpl-bbelementor-template-modal-header",ui:{closeModal:"#bbelementor-template-modal-header-close-modal"},events:{"click @ui.closeModal":"onCloseModalClick"},regions:{headerLogo:"#bbelementor-template-modal-header-logo-area",headerTabs:"#bbelementor-template-modal-header-tabs",headerActions:"#bbelementor-template-modal-header-actions"},onCloseModalClick:function(){a.closeModal()}}),o.TabModel=Backbone.Model.extend({defaults:{slug:"",title:""}}),o.LibraryCollection=Backbone.Collection.extend({model:o.ModalTemplateModel}),o.ModalTabsCollection=Backbone.Collection.extend({model:o.TabModel}),o.CategoryModel=Backbone.Model.extend({defaults:{slug:"",title:""}}),o.CategoriesCollection=Backbone.Collection.extend({model:o.CategoryModel}),o.ModalHeaderLogo=Marionette.ItemView.extend({template:"#tmpl-bbelementor-template-modal-header-logo",id:"bbelementor-template-modal-header-logo"}),o.ModalBodyView=Marionette.LayoutView.extend({id:"bbelementor-template-library-content",className:function(){return"library-tab-"+a.getTab()},template:"#tmpl-bbelementor-template-modal-content",regions:{contentTemplates:".bbelementor-templates-list",contentFilters:".bbelementor-filters-list",contentSearch:"#elementor-template-library-filter-text-wrapper"}}),o.TemplatesEmptyView=Marionette.LayoutView.extend({id:"bbelementor-template-modal-empty",template:"#tmpl-bbelementor-template-modal-empty",ui:{title:".elementor-template-library-blank-title"},regions:{contentTemplates:".bbelementor-templates-list",contentFilters:".bbelementor-filters-list",contentSearch:"#elementor-template-library-filter-text-wrapper"}}),o.ModalInsertTemplateBehavior=Marionette.Behavior.extend({ui:{insertButton:".bbelementor-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){var t=this.view.model,l={};a.layout.showLoadingView(),i.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"bb_elementor_sections_inner_template",template:t.attributes,tab:a.getTab()}}),elementor.templates.requestTemplateContent(t.get("source"),t.get("template_id"),{data:{tab:a.getTab(),page_settings:!1},success:function(e){console.log("%c Template Inserted Successfully!!","color: #7a7a7a; background-color: #eee;"),a.closeModal(),elementor.channels.data.trigger("template:before:insert",t),null!==a.atIndex&&(l.at=a.atIndex),elementor.previewView.addChildModel(e.content,l),elementor.channels.data.trigger("template:after:insert",t),a.atIndex=null,jQuery(".elementor-button-success").removeClass("elementor-disabled")},error:function(e){a.closeModal()}})}}),o.FiltersItemView=Marionette.ItemView.extend({template:"#tmpl-bbelementor-template-modal-filters-item",className:function(){return"bbelementor-template-filter-item"},ui:function(){return{filterLabels:".bbelementor-template-filter-label"}},events:function(){return{"click @ui.filterLabels":"onFilterClick"}},onFilterClick:function(e){var t=jQuery(e.target);a.setFilter("category",t.val())}}),o.TemplateSearchCollectionView=Marionette.CompositeView.extend({template:"#tmpl-bbelementor-template-modal-search-item",id:"bbelementor-template-modal-search-item",ui:function(){return{textFilter:"#elementor-template-library-filter-text"}},events:function(){return{"input @ui.textFilter":"onTextFilterInput"}},onTextFilterInput:function(e){var t=this.ui.textFilter.val();a.setFilter("text",t)}}),o.ModalTabsItemView=Marionette.ItemView.extend({template:"#tmpl-bbelementor-template-modal-tabs-item",className:function(){return"elementor-template-library-menu-item"},ui:function(){return{tabsLabels:"label",tabsInput:"input"}},events:function(){return{"click @ui.tabsLabels":"onTabClick"}},onRender:function(){this.model.get("slug")===a.getTab()&&this.ui.tabsInput.attr("checked","checked")},onTabClick:function(e){var t=jQuery(e.target);a.setTab(t.val())}}),o.FiltersCollectionView=Marionette.CompositeView.extend({id:"bbelementor-template-library-filters",template:"#tmpl-bbelementor-template-modal-filters",childViewContainer:"#bbelementor-modal-filters-container",getChildView:function(e){return o.FiltersItemView}}),o.ModalTabsCollectionView=Marionette.CompositeView.extend({template:"#tmpl-bbelementor-template-modal-tabs",childViewContainer:"#bbelementor-modal-tabs-items",initialize:function(){this.listenTo(a.channels.layout,"tamplate:cloned",this._renderChildren)},getChildView:function(e){return o.ModalTabsItemView}}),o.ModalTemplateItemView=Marionette.ItemView.extend({template:"#tmpl-bbelementor-template-modal-item",className:function(){return"remote","elementor-template-library-template elementor-template-library-template-remote bbelementor-template-has-url"},ui:function(){return{previewButton:".elementor-template-library-template-preview"}},behaviors:{insertTemplate:{behaviorClass:o.ModalInsertTemplateBehavior}}}),o.ModalCollectionView=Marionette.CompositeView.extend({template:"#tmpl-bbelementor-template-modal-templates",id:"bbelementor-template-library-templates",childViewContainer:"#bbelementor-modal-templates-container",emptyView:function(){return new o.TemplatesEmptyView},initialize:function(){this.listenTo(a.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=a.getFilter("category"),l=a.getFilter("text");return!t&&!l||(t&&!l?_.contains(e.get("categories"),t):!!(l&&!t&&0<=e.get("title").toLowerCase().indexOf(l))||(l&&t?_.contains(e.get("categories"),t)&&0<=e.get("title").toLowerCase().indexOf(l):void 0))},getChildView:function(e){return o.ModalTemplateItemView},onRenderCollection:function(){var e=this.$childViewContainer,t=this.$childViewContainer.children(),l=a.getTab();"bb_elementor_sections_page"!==l&&"local"!==l&&e.imagesLoaded(function(){}).done(function(){o.masonry.init({container:e,items:t})})}}),o.ModalLayoutView=Marionette.LayoutView.extend({el:"#bbelementor-template-modal",regions:n.modalRegions,initialize:function(){this.getRegion("modalHeader").show(new o.ModalHeaderView),this.listenTo(a.channels.tabs,"filter:change",this.switchTabs)},switchTabs:function(){this.showLoadingView(),a.requestTemplates(a.getTab())},getHeaderView:function(){return this.getRegion("modalHeader").currentView},getContentView:function(){return this.getRegion("modalContent").currentView},showLoadingView:function(){this.modalContent.show(new o.ModalLoadingView)},showError:function(){this.modalContent.show(new o.ModalErrorView)},showTemplatesView:function(e,t){if(0!==e.length){this.getRegion("modalContent").show(new o.ModalBodyView);var l=this.getContentView(),n=this.getHeaderView();a.collections.tabs=new o.ModalTabsCollection(a.getTabs()),n.headerTabs.show(new o.ModalTabsCollectionView({collection:a.collections.tabs})),l.contentTemplates.show(new o.ModalCollectionView({collection:e})),l.contentFilters.show(new o.FiltersCollectionView({collection:t})),l.contentSearch.show(new o.TemplateSearchCollectionView)}else this.getRegion("modalContent").show(new o.TemplatesEmptyView)}}),o.ModalLoadingView=Marionette.ItemView.extend({id:"bbelementor-template-modal-loading",template:"#tmpl-bbelementor-template-modal-loading"}),o.ModalErrorView=Marionette.ItemView.extend({id:"bbelementor-template-modal-error",template:"#tmpl-bbelementor-template-modal-error"})},masonry:{self:{},elements:{},init:function(e){var t=this;t.settings=i.extend(t.getDefaultSettings(),e),t.elements=t.getDefaultElements(),t.run()},getSettings:function(e){return e?this.settings[e]:this.settings},getDefaultSettings:function(){return{container:null,items:null,columnsCount:3,verticalSpaceBetween:30}},getDefaultElements:function(){return{$container:jQuery(this.getSettings("container")),$items:jQuery(this.getSettings("items"))}},run:function(){var r=[],s=this.elements.$container.position().top,m=this.getSettings(),d=m.columnsCount;s+=parseInt(this.elements.$container.css("margin-top"),10),this.elements.$container.height(""),this.elements.$items.each(function(e){var t=Math.floor(e/d),l=e%d,n=jQuery(this),o=n.position(),i=n[0].getBoundingClientRect().height+m.verticalSpaceBetween;if(t){var a=o.top-s-r[l];a-=parseInt(n.css("margin-top"),10),a*=-1,n.css("margin-top",a+"px"),r[l]+=i}else r.push(i)}),this.elements.$container.height(Math.max.apply(Math,r))}}}),layout:!1,collections:{},tabs:{},defaultTab:"",channels:{},atIndex:null,init:function(){window.elementor.on("document:loaded",window._.bind(a.onPreviewLoaded,a)),r.init()},onPreviewLoaded:function(){this.initBBElementorSectionsTempsButton(),window.elementor.$previewContents.on("click.addBBElementorSectionsTemplate",".ba-add-section-btn",_.bind(this.showTemplatesModal,this)),this.channels={templates:Backbone.Radio.channel("BBELEMENTOR_EDITOR:templates"),tabs:Backbone.Radio.channel("BBELEMENTOR_EDITOR:tabs"),layout:Backbone.Radio.channel("BBELEMENTOR_EDITOR:layout")},this.tabs=n.tabs,this.defaultTab=n.defaultTab},initBBElementorSectionsTempsButton:function(){setTimeout(function(){var e=window.elementor.$previewContents.find(".elementor-add-new-section"),t="<div class='elementor-add-section-area-button ba-add-section-btn' title='Add Elementor Sections Template'><img src='"+n.icon+"'></div>";e.length&&i(t).prependTo(e),window.elementor.$previewContents.on("click.addBBElementorSectionsTemplate",".elementor-editor-section-settings .elementor-editor-element-add",function(){var e=i(this).closest(".elementor-top-section"),l=e.data("model-cid");-1!==n.Elementor_Version.indexOf("3.0.")?window.elementor.previewView.collection.length&&i.each(window.elementor.previewView.collection.models,function(e,t){l===t.cid&&(a.atIndex=e)}):elementor.previewView.collection.length&&i.each(elementor.previewView.collection.models,function(e,t){l===t.cid&&(a.atIndex=e)}),setTimeout(function(){e.prev(".elementor-add-section").find(".elementor-add-new-section").prepend(t)},100)})},100)},getFilter:function(e){return this.channels.templates.request("filter:"+e)},setFilter:function(e,t){this.channels.templates.reply("filter:"+e,t),this.channels.templates.trigger("filter:change")},getTab:function(){return this.channels.tabs.request("filter:tabs")},setTab:function(e,t){this.channels.tabs.reply("filter:tabs",e),t||this.channels.tabs.trigger("filter:change")},getTabs:function(){var l=[];return _.each(this.tabs,function(e,t){l.push({slug:t,title:e.title})}),l},showTemplatesModal:function(){this.getModal().show(),this.layout||(this.layout=new r.ModalLayoutView,this.layout.showLoadingView()),this.setTab(this.defaultTab,!0),this.requestTemplates(this.defaultTab)},requestTemplates:function(n){if(""!==n){var o=this,e=o.tabs[n];o.setFilter("category",!1),e.data.templates&&e.data.categories?o.layout.showTemplatesView(e.data.templates,e.data.categories):i.ajax({url:ajaxurl,type:"get",dataType:"json",data:{action:"bb_elementor_sections_get_templates",tab:n},success:function(e){console.log("%cTemplates Retrieved Successfully!!","color: #7a7a7a; background-color: #eee;");var t=new r.LibraryCollection(e.data.templates),l=new r.CategoriesCollection(e.data.categories);o.tabs[n].data={templates:t,categories:l},o.layout.showTemplatesView(t,l)},error:function(e){a.closeModal()}})}},closeModal:function(){this.getModal().hide()},getModal:function(){return this.modal||(this.modal=elementor.dialogsManager.createWidget("lightbox",{id:"bbelementor-template-modal",className:"elementor-templates-modal",closeButton:!1})),this.modal}},i(window).on("elementor:init",a.init)}(jQuery);